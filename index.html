import React, { useMemo, useState, useEffect } from "react";
import { motion, AnimatePresence } from "framer-motion";
import {
  Flame,
  Sparkles,
  Box,
  ShieldCheck,
  Truck,
  ArrowRight,
  Gift,
  Check,
  Globe,
  ChevronDown,
  BadgeCheck,
  Menu,
  X,
  CreditCard
} from "lucide-react";

// --- CONFIGURATION & LINKS ---

const BRAND = {
  name: "Ignation Box",
  domain: "ignationbox.com",
  tagline: "Where grillers ‘meat’",
  colors: {
    ember: "#FF4D1A",
    ember2: "#FF7A18",
    charcoal: "#0B0F14",
    graphite: "#121824",
    smoke: "#E9EEF5",
    ash: "#A9B4C2",
    white: "#FFFFFF",
  },
};

// Verified Links from your request
const STRIPE_TEST = {
  // Spark Box -> ...MU02
  spark: "https://buy.stripe.com/test_6oUdR2f5Rdqh7XUeuLaMU02",
  // Flame Box -> ...MU01
  flame: "https://buy.stripe.com/test_4gM3cobTF4TLba6gCTaMU01",
  // Lava Box -> ...MU00
  lava: "https://buy.stripe.com/test_6oU6oA5vhcmdguq2M3aMU00",
};

const I18N = {
  es: {
    nav: { boxes: "Cajas", how: "Cómo funciona", what: "Qué incluye", faq: "FAQ" },
    hero: {
      kicker: "Mystery box mensual para asadores",
      h1: "La sorpresa que te da ganas de prender el fuego.",
      p: "Cada mes llega una caja curada con carne seca premium, selecciones sorpresa y tips prácticos para cocinar mejor—sin complicar operaciones ni romper la magia.",
      cta1: "Ver cajas",
      cta2: "Comprar ahora",
      trust: ["Pagos seguros", "Envío internacional", "Sorpresa real"],
    },
    strips: {
      s1: { t: "100% sorpresa", p: "No revelamos el contenido. Tú eliges el nivel de fuego." },
      s2: { t: "Tips incluidos", p: "Consejos cortos y útiles para mejorar en cada asado." },
      s3: { t: "Fácil de repetir", p: "Formato estándar: simple de armar, simple de enviar." },
    },
    pricing: {
      title: "Elige tu nivel de fuego",
      subtitle: "Misma estructura. Más valor conforme subes de nivel.",
      note: "Links de compra en modo TEST.",
      buy: "Comprar",
      view: "Ver detalles",
      popular: "Más popular",
      best: "Mejor entrada",
      premium: "Premium",
    },
    includes: {
      title: "Qué incluye cada caja",
      subtitle: "Sin perecederos. Sin estrés logístico. Solo experiencia curada.",
      cols: {
        jerky: { t: "Carne seca premium", p: "El corazón de la caja. Siempre jerky (gourmet o clásico según el nivel)." },
        surprises: { t: "Selecciones sorpresa", p: "Sabores, combos y hallazgos que cambian cada mes." },
        tips: { t: "Tips para cocinar", p: "Guías rápidas: cómo usar, cuándo aplicar, y cómo mejorar tu resultado." },
        utility: { t: "Algo útil", p: "Un extra funcional para el asador (simple, ligero y útil)." },
      },
    },
    how: {
      title: "Cómo funciona",
      steps: [
        { t: "Elige tu caja", p: "Spark, Flame o Lava. Tú decides qué tan intensa quieres la sorpresa." },
        { t: "Recíbela", p: "Empacada para enviar fácil y llegar sin complicaciones." },
        { t: "Cocina y presume", p: "Aplica los tips, prende el fuego y comparte tu resultado." },
      ],
    },
    faq: {
      title: "Preguntas frecuentes",
      items: [
        { q: "¿Qué tipo de carne viene?", a: "Siempre carne seca (jerky). Es lo que nos permite enviar fácil y mantener la calidad." },
        { q: "¿Revelan el contenido?", a: "No. La sorpresa es parte de la experiencia. Solo eliges el nivel de fuego." },
        { q: "¿Envían internacionalmente?", a: "Sí. Al ser productos no perecederos, la logística es más simple." },
        { q: "¿Puedo comprar una sola vez?", a: "Sí. En esta versión usamos links de compra en modo TEST." },
      ],
    },
    email: {
      title: "Recibe el drop",
      p: "Te avisamos cuando haya nuevo drop y ediciones limitadas.",
      placeholder: "Tu email",
      cta: "Unirme",
      success: "¡Listo! Te avisaremos.",
      note: "Sin spam.",
    },
    footer: {
      rights: "Todos los derechos reservados.",
      legal: "Términos • Privacidad • Reembolsos",
    },
  },
  en: {
    nav: { boxes: "Boxes", how: "How it works", what: "What’s inside", faq: "FAQ" },
    hero: {
      kicker: "Monthly mystery box for grillers",
      h1: "The surprise that makes you want to light the fire.",
      p: "Every month, a curated box with premium jerky, surprise selections, and practical cooking tips—built to stay simple and scalable while keeping the mystery alive.",
      cta1: "See boxes",
      cta2: "Buy now",
      trust: ["Secure payments", "Worldwide shipping", "Real mystery"],
    },
    strips: {
      s1: { t: "100% mystery", p: "We don’t reveal the content. You pick the fire level." },
      s2: { t: "Tips included", p: "Short, useful guidance to level up every cook." },
      s3: { t: "Easy to repeat", p: "A standard format that’s easy to pack and ship." },
    },
    pricing: {
      title: "Choose your fire level",
      subtitle: "Same structure. More value as you level up.",
      note: "TEST purchase links.",
      buy: "Buy",
      view: "View details",
      popular: "Most popular",
      best: "Best entry",
      premium: "Premium",
    },
    includes: {
      title: "What’s inside each box",
      subtitle: "No perishables. No logistics stress. Just curated experience.",
      cols: {
        jerky: { t: "Premium jerky", p: "The heart of the box. Always jerky (classic or gourmet by tier)." },
        surprises: { t: "Surprise selections", p: "Flavors, combos, and finds that change every month." },
        tips: { t: "Cooking tips", p: "Quick guides: how to use it, when to apply, and how to improve." },
        utility: { t: "Something useful", p: "A functional add-on for your grilling setup (light + practical)." },
      },
    },
    how: {
      title: "How it works",
      steps: [
        { t: "Pick your box", p: "Spark, Flame, or Lava. Choose how intense you want the mystery." },
        { t: "Receive it", p: "Packed for simple shipping and smooth delivery." },
        { t: "Cook & share", p: "Use the tips, light the fire, and show off your result." },
      ],
    },
    faq: {
      title: "FAQ",
      items: [
        { q: "What kind of meat is included?", a: "Always jerky. That’s how we keep shipping simple and quality consistent." },
        { q: "Do you reveal the content?", a: "No. The mystery is the experience. You only pick your fire level." },
        { q: "Do you ship worldwide?", a: "Yes. Since it’s non-perishable, logistics stay simple." },
        { q: "Can I buy once?", a: "Yes. This version uses Stripe TEST purchase links." },
      ],
    },
    email: {
      title: "Get the drop",
      p: "Drop alerts + limited editions.",
      placeholder: "Your email",
      cta: "Join",
      success: "You're on the list!",
      note: "No spam.",
    },
    footer: {
      rights: "All rights reserved.",
      legal: "Terms • Privacy • Refunds",
    },
  },
};

// --- CUSTOM UI COMPONENTS (Inline for portability) ---

function Button({ children, variant = "primary", className = "", onClick, ...props }) {
  const baseStyle = "inline-flex items-center justify-center rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--ember)] disabled:opacity-50 disabled:pointer-events-none";
  const sizes = "h-10 px-4 py-2 text-sm";
  const variants = {
    primary: "bg-[var(--ember)] hover:bg-[var(--ember2)] text-white shadow-lg shadow-orange-900/20",
    secondary: "bg-white/5 text-white border border-white/10 hover:bg-white/10 backdrop-blur-sm",
    ghost: "hover:bg-white/5 text-white/80 hover:text-white",
  };
  
  return (
    <button className={`${baseStyle} ${sizes} ${variants[variant]} ${className}`} onClick={onClick} {...props}>
      {children}
    </button>
  );
}

function Badge({ children, className = "" }) {
  return (
    <div className={`inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 ${className}`}>
      {children}
    </div>
  );
}

function Card({ className = "", children }) {
  return <div className={`rounded-xl border shadow-sm ${className}`}>{children}</div>;
}

function CardHeader({ className = "", children }) {
  return <div className={`flex flex-col space-y-1.5 p-6 ${className}`}>{children}</div>;
}

function CardTitle({ className = "", children }) {
  return <h3 className={`font-semibold leading-none tracking-tight ${className}`}>{children}</h3>;
}

function CardDescription({ className = "", children }) {
  return <p className={`text-sm text-muted-foreground ${className}`}>{children}</p>;
}

function CardContent({ className = "", children }) {
  return <div className={`p-6 pt-0 ${className}`}>{children}</div>;
}

function Input({ className = "", ...props }) {
  return (
    <input
      className={`flex h-10 w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ember)] focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${className}`}
      {...props}
    />
  );
}

// --- HELPER FUNCTIONS ---

function cn(...classes) {
  return classes.filter(Boolean).join(" ");
}

function useThemeVars() {
  return useMemo(
    () => ({
      "--ember": BRAND.colors.ember,
      "--ember2": BRAND.colors.ember2,
      "--charcoal": BRAND.colors.charcoal,
      "--graphite": BRAND.colors.graphite,
      "--smoke": BRAND.colors.smoke,
      "--ash": BRAND.colors.ash,
    }),
    []
  );
}

function go(url) {
  if (!url) return;
  // Using _blank to keep the user on the site while they check out
  window.open(url, "_blank", "noopener,noreferrer");
}

function smoothTo(id) {
  const element = document.getElementById(id);
  if (element) {
    // Offset for the sticky header
    const headerOffset = 80;
    const elementPosition = element.getBoundingClientRect().top;
    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

    window.scrollTo({
      top: offsetPosition,
      behavior: "smooth"
    });
  }
}

// --- SUB-COMPONENTS ---

function Nav({ t, lang, setLang }) {
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

  return (
    <div className="sticky top-0 z-50 backdrop-blur-md bg-[rgba(11,15,20,0.85)] border-b border-white/10 supports-[backdrop-filter]:bg-[rgba(11,15,20,0.6)]">
      <div className="mx-auto max-w-6xl px-4 py-3 flex items-center justify-between">
        <a href="#top" onClick={(e) => { e.preventDefault(); smoothTo("top"); }} className="flex items-center gap-2 group">
          <div className="h-9 w-9 rounded-xl bg-gradient-to-br from-[var(--ember)] to-[var(--ember2)] flex items-center justify-center shadow-lg shadow-orange-900/30 group-hover:scale-105 transition-transform">
            <Flame className="h-5 w-5 text-white" fill="currentColor" />
          </div>
          <div className="leading-tight">
            <div className="text-sm text-white font-bold tracking-wide">{BRAND.name}</div>
          </div>
        </a>

        {/* Desktop Nav */}
        <div className="hidden md:flex items-center gap-6 text-sm font-medium text-white/70">
          <button className="hover:text-[var(--ember)] transition-colors" onClick={() => smoothTo("boxes")}>{t.nav.boxes}</button>
          <button className="hover:text-[var(--ember)] transition-colors" onClick={() => smoothTo("how")}>{t.nav.how}</button>
          <button className="hover:text-[var(--ember)] transition-colors" onClick={() => smoothTo("includes")}>{t.nav.what}</button>
          <button className="hover:text-[var(--ember)] transition-colors" onClick={() => smoothTo("faq")}>{t.nav.faq}</button>
        </div>

        <div className="flex items-center gap-2">
          <Button
            variant="secondary"
            className="hidden md:inline-flex bg-white/5 text-xs h-8 px-3"
            onClick={() => setLang(lang === "es" ? "en" : "es")}
          >
            {lang === "es" ? "EN" : "ES"}
          </Button>
          <Button
            className="hidden md:inline-flex bg-[var(--ember)] hover:bg-[var(--ember2)] text-white font-semibold"
            onClick={() => smoothTo("boxes")}
          >
            {lang === "es" ? "Comprar" : "Shop Boxes"}
          </Button>

          {/* Mobile Menu Toggle */}
          <button 
            className="md:hidden p-2 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-colors"
            onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
          >
             {mobileMenuOpen ? <X className="h-6 w-6" /> : <Menu className="h-6 w-6" />}
          </button>
        </div>
      </div>

      {/* Mobile Menu Dropdown */}
      <AnimatePresence>
        {mobileMenuOpen && (
          <motion.div 
            initial={{ height: 0, opacity: 0 }}
            animate={{ height: "auto", opacity: 1 }}
            exit={{ height: 0, opacity: 0 }}
            className="md:hidden border-b border-white/10 bg-[#0B0F14] overflow-hidden"
          >
             <div className="px-4 py-4 flex flex-col gap-4 text-sm">
                <button className="text-left text-white/80 py-2 border-b border-white/5" onClick={() => { smoothTo("boxes"); setMobileMenuOpen(false); }}>{t.nav.boxes}</button>
                <button className="text-left text-white/80 py-2 border-b border-white/5" onClick={() => { smoothTo("how"); setMobileMenuOpen(false); }}>{t.nav.how}</button>
                <button className="text-left text-white/80 py-2 border-b border-white/5" onClick={() => { smoothTo("includes"); setMobileMenuOpen(false); }}>{t.nav.what}</button>
                <button className="text-left text-white/80 py-2 border-b border-white/5" onClick={() => { smoothTo("faq"); setMobileMenuOpen(false); }}>{t.nav.faq}</button>
                <div className="flex items-center justify-between pt-2">
                   <span className="text-white/60">Language / Idioma</span>
                   <Button variant="secondary" size="sm" onClick={() => setLang(lang === "es" ? "en" : "es")}>
                     {lang === "es" ? "Switch to English" : "Cambiar a Español"}
                   </Button>
                </div>
             </div>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
}

function Hero({ t, lang }) {
  // Primary CTA goes to Flame (Middle Tier)
  const primaryLink = STRIPE_TEST.flame; 

  return (
    <div className="relative overflow-hidden" id="top">
      {/* Dynamic Background */}
      <div className="absolute inset-0 opacity-40 pointer-events-none">
        <div className="absolute -top-[20%] -left-[10%] w-[50%] h-[50%] rounded-full bg-[var(--ember)] blur-[120px] mix-blend-screen opacity-40 animate-pulse" />
        <div className="absolute top-[20%] -right-[10%] w-[40%] h-[40%] rounded-full bg-orange-600 blur-[100px] mix-blend-screen opacity-30" />
      </div>

      <div className="mx-auto max-w-6xl px-4 pt-14 pb-16 relative z-10">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.6 }}
          className="grid md:grid-cols-12 gap-12 items-center"
        >
          <div className="md:col-span-7">
            <motion.div 
              initial={{ opacity: 0, x: -20 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ delay: 0.2 }}
              className="inline-flex items-center gap-2 rounded-full bg-white/5 border border-white/10 px-3 py-1 text-xs font-medium text-[var(--ember2)] mb-6"
            >
              <Globe className="h-3.5 w-3.5" />
              <span className="text-white/90">{t.hero.kicker}</span>
            </motion.div>

            <h1 className="text-4xl md:text-6xl font-bold tracking-tight text-white leading-[1.1]">
              {t.hero.h1}
            </h1>
            <p className="mt-6 text-lg text-white/75 max-w-xl leading-relaxed">
              {t.hero.p}
            </p>

            <div className="mt-8 flex flex-wrap gap-4">
              <Button
                className="h-12 px-8 text-base bg-[var(--ember)] hover:bg-[var(--ember2)] text-white shadow-lg shadow-orange-900/40"
                onClick={() => smoothTo("boxes")}
              >
                {t.hero.cta1} <ArrowRight className="ml-2 h-4 w-4" />
              </Button>
              <Button
                variant="secondary"
                className="h-12 px-6 bg-white/5 text-white border border-white/10 hover:bg-white/10 hover:border-white/20"
                onClick={() => go(primaryLink)}
              >
                {t.hero.cta2}
              </Button>
            </div>

            <div className="mt-8 grid grid-cols-2 sm:grid-cols-3 gap-3 max-w-2xl">
              {t.hero.trust.map((x) => (
                <div key={x} className="flex items-center gap-2 text-sm text-white/60">
                  <ShieldCheck className="h-4 w-4 text-[var(--ember)]" />
                  <span>{x}</span>
                </div>
              ))}
            </div>
          </div>

          <div className="md:col-span-5 relative">
             <div className="absolute inset-0 bg-gradient-to-tr from-[var(--ember)] to-transparent opacity-10 blur-2xl -z-10 rounded-full" />
             <HeroImageCard lang={lang} />
          </div>
        </motion.div>

        {/* Value Props Strip */}
        <div className="mt-20 grid md:grid-cols-3 gap-6">
          {Object.values(t.strips).map((s, i) => (
            <motion.div 
              key={s.t} 
              initial={{ opacity: 0, y: 20 }}
              whileInView={{ opacity: 1, y: 0 }}
              viewport={{ once: true }}
              transition={{ delay: i * 0.1 }}
            >
              <Card className="bg-white/5 border-white/10 text-white h-full hover:bg-white/[0.07] transition-colors">
                <CardHeader>
                  <CardTitle className="text-lg flex items-center gap-2">
                     {i === 0 && <Box className="h-5 w-5 text-[var(--ember)]" />}
                     {i === 1 && <Sparkles className="h-5 w-5 text-[var(--ember)]" />}
                     {i === 2 && <Truck className="h-5 w-5 text-[var(--ember)]" />}
                     {s.t}
                  </CardTitle>
                  <CardDescription className="text-white/60 mt-2">{s.p}</CardDescription>
                </CardHeader>
              </Card>
            </motion.div>
          ))}
        </div>

        <div className="mt-12 flex items-center justify-center animate-bounce">
          <button
            className="text-white/40 hover:text-white flex flex-col items-center gap-2 text-sm transition-colors"
            onClick={() => smoothTo("boxes")}
          >
            {lang === "es" ? "Ver cajas" : "See boxes"} <ChevronDown className="h-4 w-4" />
          </button>
        </div>
      </div>

      {/* Mobile sticky bar */}
      <div className="fixed bottom-0 left-0 right-0 z-40 md:hidden pb-safe">
        <div className="p-4 bg-gradient-to-t from-black via-black/90 to-transparent">
          <div className="rounded-xl bg-[#1A1F26] border border-white/10 p-3 shadow-2xl flex items-center justify-between ring-1 ring-white/5">
            <div className="text-sm text-white pl-1">
              <div className="font-bold text-[var(--ember2)]">{BRAND.name}</div>
              <div className="text-xs text-white/50">{lang === "es" ? "Jerky Misterioso" : "Mystery Jerky"}</div>
            </div>
            <Button className="bg-[var(--ember)] hover:bg-[var(--ember2)] text-white font-bold shadow-lg" onClick={() => smoothTo("boxes")}>
              {lang === "es" ? "Elegir Caja" : "Choose Box"}
            </Button>
          </div>
        </div>
      </div>
    </div>
  );
}

function HeroImageCard({ lang }) {
  return (
    <motion.div 
      whileHover={{ y: -5 }}
      transition={{ type: "spring", stiffness: 300 }}
      className="rounded-[28px] border border-white/10 bg-gradient-to-b from-white/10 to-white/5 p-3 shadow-2xl backdrop-blur-sm"
    >
      <div className="rounded-2xl bg-[#0F131A] border border-white/5 p-5 relative overflow-hidden">
        <div className="flex items-center justify-between relative z-10 mb-4">
          <div>
            <div className="text-white font-bold text-lg">{lang === "es" ? "Unboxing del mes" : "This month’s unboxing"}</div>
            <div className="text-xs text-[var(--ember2)] font-medium tracking-wide">{lang === "es" ? "MYSTERY • JERKY • TIPS" : "MYSTERY • JERKY • TIPS"}</div>
          </div>
          <Badge className="bg-[var(--ember)]/20 text-[var(--ember2)] border-[var(--ember)]/30">{lang === "es" ? "Sorpresa" : "Mystery"}</Badge>
        </div>

        {/* SVG Illustration */}
        <div className="rounded-xl overflow-hidden border border-white/10 bg-black/40 relative group cursor-default">
           <div className="absolute inset-0 bg-gradient-to-b from-transparent to-black/60 z-10 pointer-events-none" />
          <svg viewBox="0 0 900 520" className="w-full h-auto transform group-hover:scale-105 transition-transform duration-700">
            <defs>
              <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stopColor="#FF4D1A" stopOpacity="0.9" />
                <stop offset="0.6" stopColor="#FF7A18" stopOpacity="0.35" />
                <stop offset="1" stopColor="#0B0F14" stopOpacity="1" />
              </linearGradient>
              <radialGradient id="g2" cx="45%" cy="35%" r="60%">
                <stop offset="0" stopColor="#FFFFFF" stopOpacity="0.1" />
                <stop offset="1" stopColor="#FFFFFF" stopOpacity="0" />
              </radialGradient>
            </defs>
            <rect width="900" height="520" fill="#0B0F14" />
            <rect width="900" height="520" fill="url(#g2)" />
            
            {/* Box Object */}
            <g transform="translate(120 160)">
              <path d="M40 70 L230 0 L440 70 L250 150 Z" fill="url(#g1)" opacity="0.9" />
              <path d="M40 70 L250 150 L250 330 L40 250 Z" fill="#161C26" />
              <path d="M440 70 L250 150 L250 330 L440 250 Z" fill="#0F131A" />
              <path d="M40 70 L230 0 L440 70" stroke="#FF7A18" strokeOpacity="0.4" strokeWidth="2" fill="none" />
              <text x="250" y="130" textAnchor="middle" fill="#FFFFFF" fontSize="28" fontWeight="bold" letterSpacing="2" fontFamily="sans-serif">IGNATION</text>
            </g>

            {/* Meat/Jerky Object */}
            <g transform="translate(580 200)" className="animate-pulse" style={{ animationDuration: '3s' }}>
              <path d="M40 40 C80 10, 130 20, 160 55 C190 95, 160 130, 115 140 C70 150, 25 120, 20 85 C15 60, 25 52, 40 40 Z" fill="#753020" />
              <path d="M60 62 C90 45, 118 52, 140 75" stroke="#A65D45" strokeWidth="6" strokeLinecap="round" opacity="0.6" />
              <path d="M55 95 C85 88, 110 95, 135 110" stroke="#A65D45" strokeWidth="6" strokeLinecap="round" opacity="0.5" />
            </g>
          </svg>
        </div>

        <div className="mt-4 grid grid-cols-2 gap-2">
          {["Premium jerky", "Surprise picks", "Cooking tips", "Useful extra"].map((x) => (
            <div key={x} className="flex items-center gap-2 text-xs text-white/70">
              <Check className="h-3 w-3 text-[var(--ember)]" />
              <span>{x}</span>
            </div>
          ))}
        </div>
      </div>
    </motion.div>
  );
}

function Pricing({ t, lang }) {
  const PLANS = [
    {
      key: "spark",
      name: "Spark Box",
      price: 36,
      badge: "best",
      icon: Sparkles,
      // Verified Link: ...MU02
      stripe: STRIPE_TEST.spark,
      vibe: {
        es: "La entrada al juego. Sorpresa fácil, rica y sin complicarte.",
        en: "Your entry level. Simple, tasty mystery—no hassle.",
      },
      bullets: {
        es: ["Carne seca premium", "Selecciones sorpresa", "Tips rápidos", "Un extra útil"],
        en: ["Premium jerky", "Surprise selections", "Quick tips", "A useful extra"],
      },
    },
    {
      key: "flame",
      name: "Flame Box",
      price: 50,
      badge: "popular",
      icon: Flame,
      // Verified Link: ...MU01
      stripe: STRIPE_TEST.flame,
      vibe: {
        es: "Más variedad. Mejor selección. El nivel que se siente mes a mes.",
        en: "More variety. Better picks. The tier you feel every month.",
      },
      bullets: {
        es: ["Más jerky / mejor selección", "Más sorpresa", "Tips para subir de nivel", "Upgrade funcional"],
        en: ["More/better jerky selection", "More mystery", "Level-up tips", "Functional upgrade"],
      },
    },
    {
      key: "lava",
      name: "Lava Box",
      price: 99.99,
      badge: "premium",
      icon: Box,
      // Verified Link: ...MU00
      stripe: STRIPE_TEST.lava,
      vibe: {
        es: "Edición premium. Menos explicación, más impacto.",
        en: "Premium edition. Less explanation, more impact.",
      },
      bullets: {
        es: ["Jerky gourmet", "Selecciones exclusivas", "Tips más avanzados", "Extra premium"],
        en: ["Gourmet jerky", "Exclusive selections", "More advanced tips", "Premium extra"],
      },
    },
  ];

  return (
    <div className="mx-auto max-w-6xl px-4 py-20 scroll-mt-24" id="boxes">
      <div className="flex flex-col md:flex-row items-end justify-between gap-6 mb-10">
        <div>
          <h2 className="text-3xl md:text-4xl font-bold text-white">{t.pricing.title}</h2>
          <p className="mt-3 text-white/60 text-lg max-w-2xl">{t.pricing.subtitle}</p>
        </div>
        <div className="flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10">
            <BadgeCheck className="h-4 w-4 text-green-500" />
            <span className="text-xs text-white/60 font-mono tracking-wide">{t.pricing.note}</span>
        </div>
      </div>

      <div className="grid md:grid-cols-3 gap-6">
        {PLANS.map((p) => {
          const Icon = p.icon;
          const badgeLabel = p.badge === "popular" ? t.pricing.popular : p.badge === "best" ? t.pricing.best : t.pricing.premium;
          const isPopular = p.badge === "popular";

          return (
            <motion.div 
                key={p.key}
                whileHover={{ y: -8 }}
                transition={{ type: "spring", stiffness: 300 }}
            >
                <Card
                  className={cn(
                    "bg-[#131820] text-white overflow-hidden relative h-full flex flex-col",
                    isPopular ? "border-[var(--ember)] shadow-[0_0_30px_-10px_rgba(255,77,26,0.3)] ring-1 ring-[var(--ember)]" : "border-white/10 hover:border-white/20"
                  )}
                >
                  {isPopular && (
                      <div className="absolute top-0 inset-x-0 h-1 bg-gradient-to-r from-[var(--ember)] to-[var(--ember2)]" />
                  )}
                  
                  <CardHeader className="pb-4">
                    <div className="flex items-start justify-between gap-3">
                      <div className="flex items-center gap-3">
                        <div className={cn("h-12 w-12 rounded-xl flex items-center justify-center border", isPopular ? "bg-[var(--ember)]/10 border-[var(--ember)]/20 text-[var(--ember)]" : "bg-white/5 border-white/10 text-white/80")}>
                          <Icon className="h-6 w-6" />
                        </div>
                        <div>
                          <CardTitle className="text-xl font-bold">{p.name}</CardTitle>
                          <div className="text-xs text-white/50 uppercase tracking-wider font-semibold mt-0.5">Mystery Drop</div>
                        </div>
                      </div>
                      <Badge className={cn("border", isPopular ? "bg-[var(--ember)] text-white border-[var(--ember)]" : "bg-white/5 text-white/70 border-white/10")}>{badgeLabel}</Badge>
                    </div>

                    <div className="mt-6 flex items-baseline gap-1">
                      <span className="text-4xl font-bold tracking-tight">${p.price}</span>
                      <span className="text-white/60 font-medium">USD</span>
                    </div>

                    <CardDescription className="text-white/70 mt-3 text-base leading-snug">
                      {p.vibe[lang]}
                    </CardDescription>
                  </CardHeader>

                  <CardContent className="flex-1 flex flex-col">
                    <div className="rounded-xl overflow-hidden border border-white/10 bg-black/40 mb-6 relative">
                         {/* Visual overlay for card */}
                        <div className="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent z-10" />
                        <PlanMiniVisual planKey={p.key} />
                        <div className="absolute bottom-2 left-3 z-20 text-[10px] font-mono text-white/50 uppercase">
                            Box v.{new Date().getMonth() + 1}
                        </div>
                    </div>

                    <div className="space-y-3 mb-8 flex-1">
                      {p.bullets[lang].map((x) => (
                        <div key={x} className="flex gap-3 text-sm text-white/80">
                          <Check className="h-5 w-5 text-[var(--ember)] shrink-0" />
                          <span>{x}</span>
                        </div>
                      ))}
                    </div>

                    <div className="grid grid-cols-2 gap-3 mt-auto">
                      <Button
                        className="bg-[var(--ember)] hover:bg-[var(--ember2)] text-white font-semibold col-span-2 md:col-span-1 lg:col-span-1"
                        onClick={() => go(p.stripe)}
                      >
                        {t.pricing.buy}
                      </Button>
                      <Button
                        variant="secondary"
                        onClick={() => {
                          const el = document.getElementById(`plan-${p.key}`);
                          el?.scrollIntoView({ behavior: "smooth", block: "center" });
                          // Animation effect would go here
                        }}
                      >
                        {t.pricing.view}
                      </Button>
                    </div>
                  </CardContent>
                </Card>
            </motion.div>
          );
        })}
      </div>
      
       {/* Hidden anchors for scroll targets */}
       <div className="sr-only">
        {PLANS.map((p) => (
          <div key={p.key} id={`plan-${p.key}`}>{p.name}</div>
        ))}
      </div>
    </div>
  );
}

function PlanMiniVisual({ planKey }) {
  const accent = planKey === "spark" ? "#FF7A18" : planKey === "flame" ? "#FF4D1A" : "#FF2D00";
  const label = planKey.toUpperCase();
  return (
    <svg viewBox="0 0 800 360" className="w-full h-auto bg-[#0F131A]">
      <defs>
        <radialGradient id={`rg-${planKey}`} cx="50%" cy="0%" r="100%">
          <stop offset="0" stopColor={accent} stopOpacity="0.2" />
          <stop offset="1" stopColor="#0B0F14" stopOpacity="0" />
        </radialGradient>
      </defs>
      <rect width="800" height="360" fill={`url(#rg-${planKey})`} />
      <g transform="translate(400 180)">
          <text x="0" y="0" textAnchor="middle" fill="white" fillOpacity="0.1" fontSize="120" fontWeight="bold" dy=".35em">{label.charAt(0)}</text>
      </g>
    </svg>
  );
}

function Includes({ t }) {
  return (
    <div className="bg-white/5 border-y border-white/5">
        <div className="mx-auto max-w-6xl px-4 py-20 scroll-mt-24" id="includes">
        <div className="text-center max-w-3xl mx-auto mb-16">
            <h2 className="text-3xl md:text-4xl font-bold text-white mb-4">{t.includes.title}</h2>
            <p className="text-lg text-white/60">{t.includes.subtitle}</p>
        </div>

        <div className="grid md:grid-cols-2 gap-6">
            {Object.values(t.includes.cols).map((c, i) => (
            <Card key={c.t} className="bg-[#131820] border-white/10 text-white hover:border-[var(--ember)]/50 transition-colors group">
                <CardHeader>
                <div className="mb-4 h-10 w-10 rounded-lg bg-white/5 flex items-center justify-center group-hover:bg-[var(--ember)] group-hover:text-white transition-colors text-white/70">
                    {i === 0 ? <Flame className="h-6 w-6" /> : i === 1 ? <Gift className="h-6 w-6" /> : i === 2 ? <BadgeCheck className="h-6 w-6" /> : <Box className="h-6 w-6" />}
                </div>
                <CardTitle className="text-lg">{c.t}</CardTitle>
                <CardDescription className="text-white/60 mt-2 text-base">{c.p}</CardDescription>
                </CardHeader>
            </Card>
            ))}
        </div>

        <div className="mt-8 rounded-2xl border border-white/10 bg-[#0F131A] p-6 md:p-8 flex flex-col md:flex-row items-center justify-between gap-6">
            <div>
                <div className="text-white font-semibold text-lg flex items-center gap-2">
                    <Truck className="h-5 w-5 text-[var(--ember)]" />
                    {t.es ? "Estándar operativo" : "Operational standard"}
                </div>
                <div className="mt-1 text-white/60 max-w-xl">
                    {t.es ? "Mismo formato siempre. Cambia la selección, no la logística." : "Same format always. The selection changes, not the logistics."}
                </div>
            </div>
            <div className="flex flex-wrap gap-3">
                {["No perecederos", "Ligero", "Fácil de empacar"].map((x) => (
                    <div key={x} className="flex items-center gap-2 rounded-full bg-white/5 border border-white/10 px-4 py-2 text-sm text-white/80">
                        <Check className="h-3.5 w-3.5 text-[var(--ember)]" />
                        <span>{x}</span>
                    </div>
                ))}
            </div>
        </div>
        </div>
    </div>
  );
}

function HowItWorks({ t }) {
  return (
    <div className="mx-auto max-w-6xl px-4 py-20 scroll-mt-24" id="how">
      <div className="mb-12">
        <h2 className="text-3xl md:text-4xl font-bold text-white">{t.how.title}</h2>
      </div>

      <div className="grid md:grid-cols-3 gap-8 relative">
        {/* Connecting line (desktop) */}
        <div className="hidden md:block absolute top-12 left-[16%] right-[16%] h-0.5 bg-gradient-to-r from-transparent via-[var(--ember)]/30 to-transparent" />

        {t.how.steps.map((s, idx) => (
          <div key={s.t} className="relative">
            <div className="h-24 w-24 rounded-2xl bg-[#1A1F26] border border-white/10 flex items-center justify-center mb-6 relative z-10 mx-auto md:mx-0 shadow-xl">
                <div className="absolute -top-3 -right-3 bg-[var(--ember)] text-white text-xs font-bold h-7 w-7 rounded-full flex items-center justify-center ring-4 ring-[#0B0F14]">
                    {idx + 1}
                </div>
                {idx === 0 ? <Box className="h-10 w-10 text-white/80" /> : idx === 1 ? <Truck className="h-10 w-10 text-white/80" /> : <Flame className="h-10 w-10 text-white/80" />}
            </div>
            <h3 className="text-xl font-bold text-white mb-3 text-center md:text-left">{s.t}</h3>
            <p className="text-white/60 leading-relaxed text-center md:text-left">{s.p}</p>
          </div>
        ))}
      </div>

      <div className="mt-16" id="gift">
        <Card className="bg-gradient-to-br from-[var(--ember)]/10 to-transparent border-[var(--ember)]/20 text-white overflow-hidden relative">
           <div className="absolute top-0 right-0 p-32 bg-[var(--ember)] blur-[100px] opacity-10 rounded-full pointer-events-none" />
          <div className="p-8 md:p-10 grid md:grid-cols-[1.5fr,2fr] gap-8 items-center relative z-10">
            <div>
                <div className="inline-flex items-center gap-2 text-[var(--ember2)] font-semibold text-sm mb-2 uppercase tracking-wide">
                    <Gift className="h-4 w-4" />
                    {t.es ? "Regalo Perfecto" : "Perfect Gift"}
                </div>
                <CardTitle className="text-2xl md:text-3xl mb-3">{t.es ? "¿Buscas un regalo único?" : "Looking for a unique gift?"}</CardTitle>
                <CardDescription className="text-white/70 text-base">
                {t.es
                    ? "Elige una caja y compra en 1 click. La sorpresa queda perfecta para cualquier asador. Sin suscripciones forzosas."
                    : "Pick a box and checkout in 1 click. Mystery makes the perfect gift for any griller. No forced subscriptions."}
                </CardDescription>
            </div>
            <div className="flex flex-col sm:flex-row gap-3 justify-end">
                <Button className="bg-white/10 hover:bg-white/20 text-white border border-white/10 h-12" onClick={() => go(STRIPE_TEST.spark)}>
                {t.es ? "Regalar Spark ($36)" : "Gift Spark ($36)"}
                </Button>
                <Button className="bg-white/10 hover:bg-white/20 text-white border border-white/10 h-12" onClick={() => go(STRIPE_TEST.flame)}>
                {t.es ? "Regalar Flame ($50)" : "Gift Flame ($50)"}
                </Button>
                <Button className="bg-[var(--ember)] hover:bg-[var(--ember2)] text-white shadow-lg h-12" onClick={() => go(STRIPE_TEST.lava)}>
                {t.es ? "Regalar Lava ($99)" : "Gift Lava ($99)"}
                </Button>
            </div>
          </div>
        </Card>
      </div>
    </div>
  );
}

function EmailCapture({ t }) {
  const [email, setEmail] = useState("");
  const [submitted, setSubmitted] = useState(false);

  const handleSubmit = () => {
    if (!email) return;
    setSubmitted(true);
    // In a real app, send to backend here
    setTimeout(() => {
        // Reset after a while if desired, or leave success state
    }, 3000);
  };

  return (
    <div className="mx-auto max-w-6xl px-4 py-12">
      <Card className="bg-[#131820] border-white/10 text-white overflow-hidden relative">
        <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-5" />
        <CardContent className="p-8 md:p-12 relative z-10">
          <div className="max-w-2xl mx-auto text-center">
            <h3 className="text-2xl md:text-3xl font-bold mb-3">{t.email.title}</h3>
            <p className="text-white/60 mb-8">{t.email.p}</p>
            
            {submitted ? (
                <motion.div 
                    initial={{ scale: 0.9, opacity: 0 }}
                    animate={{ scale: 1, opacity: 1 }}
                    className="bg-green-500/10 border border-green-500/20 text-green-400 py-3 px-6 rounded-lg inline-flex items-center gap-2"
                >
                    <Check className="h-5 w-5" />
                    <span className="font-semibold">{t.email.success}</span>
                </motion.div>
            ) : (
                <div className="flex flex-col sm:flex-row gap-3 max-w-md mx-auto">
                    <Input
                        value={email}
                        onChange={(e) => setEmail(e.target.value)}
                        placeholder={t.email.placeholder}
                        className="bg-black/20 border-white/10 text-white placeholder:text-white/30 h-12 focus-visible:ring-[var(--ember)]"
                    />
                    <Button
                        className="bg-[var(--ember)] hover:bg-[var(--ember2)] text-white h-12 px-8 font-semibold"
                        onClick={handleSubmit}
                    >
                        {t.email.cta}
                    </Button>
                </div>
            )}
            
            <div className="mt-4 text-xs text-white/40 flex items-center justify-center gap-1">
                <ShieldCheck className="h-3 w-3" />
                {t.email.note}
            </div>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}

function FAQ({ t }) {
  return (
    <div className="mx-auto max-w-6xl px-4 py-20 scroll-mt-24" id="faq">
      <h2 className="text-3xl font-bold text-white mb-8">{t.faq.title}</h2>
      <div className="grid md:grid-cols-2 gap-6">
        {t.faq.items.map((x, i) => (
          <Card key={i} className="bg-white/5 border-white/10 text-white hover:bg-white/[0.08] transition-colors">
            <CardHeader>
              <CardTitle className="text-lg leading-snug">{x.q}</CardTitle>
              <CardDescription className="text-white/60 mt-3 text-base leading-relaxed">{x.a}</CardDescription>
            </CardHeader>
          </Card>
        ))}
      </div>
    </div>
  );
}

function Footer({ t }) {
  return (
    <div className="border-t border-white/10 bg-[#080a0e] pt-12 pb-24 md:pb-12">
      <div className="mx-auto max-w-6xl px-4 flex flex-col md:flex-row items-center justify-between gap-6 text-center md:text-left">
        <div className="flex items-center gap-3">
             <div className="h-10 w-10 rounded-xl bg-white/5 flex items-center justify-center">
                 <Flame className="h-6 w-6 text-[var(--ember)]" />
             </div>
             <div>
                <div className="text-white font-bold text-lg tracking-wide">{BRAND.name}</div>
                <div className="text-xs text-white/40">© {new Date().getFullYear()} {BRAND.domain}</div>
             </div>
        </div>
        
        <div className="flex items-center gap-6 text-sm text-white/40">
           {/* These are intentionally inert to prevent 404s, user can add real links later */}
           <span className="cursor-default hover:text-white/60 transition-colors">Terms</span>
           <span className="cursor-default hover:text-white/60 transition-colors">Privacy</span>
           <span className="cursor-default hover:text-white/60 transition-colors">Refunds</span>
        </div>
        
        <div className="flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/5 text-xs text-white/30">
            <div className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
            <span>System Operational</span>
        </div>
      </div>
    </div>
  );
}

export default function IgnationBoxSiteV2() {
  const [lang, setLang] = useState("es");
  const t = I18N[lang];
  const themeVars = useThemeVars();

  return (
    <div style={themeVars} className="min-h-screen text-white bg-[var(--charcoal)] font-sans selection:bg-[var(--ember)] selection:text-white">
      <Nav t={t} lang={lang} setLang={setLang} />
      <Hero t={t} lang={lang} />
      <Pricing t={t} lang={lang} />
      <HowItWorks t={t} />
      <Includes t={t} />
      <FAQ t={t} />
      <EmailCapture t={t} />
      <Footer t={t} />
    </div>
  );
}
